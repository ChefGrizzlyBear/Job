<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Listings Map</title>
    <!-- Tailwind CSS CDN for basic styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for the map container */
        #map {
            height: 80vh; /* Set a height for the map */
            width: 100%; /* Full width */
            border-radius: 0.5rem; /* Rounded corners */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Subtle shadow */
        }
        body {
            font-family: "Inter", sans-serif; /* Use Inter font */
            background-color: #f3f4f6; /* Light gray background */
        }
        /* Style for the info window content */
        .info-window-content {
            padding: 0.5rem;
            font-size: 0.875rem;
            color: #333;
            max-width: 250px; /* Limit info window width for better readability */
        }
        .info-window-content h3 {
            font-weight: bold;
            margin-bottom: 0.25rem;
            color: #1f2937;
        }
        .info-window-content p {
            margin-bottom: 0.25rem; /* Add some spacing between paragraphs */
        }
        .info-window-content strong {
            color: #4b5563;
        }
        /* Styles for the alert message */
        .alert {
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
            font-size: 0.9rem;
            text-align: center;
        }
        .alert-warning {
            background-color: #fff3cd;
            color: #664d03;
            border: 1px solid #ffecb5;
        }
        .alert-danger {
            background-color: #f8d7da;
            color: #842029;
            border: 1px solid #f5c2c7;
        }
    </style>
</head>
<body class="p-4 bg-gray-100 min-h-screen flex flex-col items-center justify-center">
    <div class="container mx-auto p-6 bg-white rounded-lg shadow-xl max-w-4xl">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">Job Locations on Map</h1>
        <div id="map" class="mb-6"></div>
        <div id="geolocation-message" class="alert d-none"></div>
        <p class="text-sm text-gray-600 text-center">
            Your Google Maps API key is included in the script tag.
        </p>
    </div>

    <script>
        // Define the job listings data with more detailed descriptions, including rating, number of ratings, price range,
        // and a new 'openAtNoonWeekday' property for conditional coloring.
        const jobListings = [
            { job: "Server", company: "Dimmi Dimmi Corner Italian", address: "1112 West Armitage Avenue, Chicago, IL", description: "Seeking an enthusiastic and experienced server to join our authentic Italian restaurant. Must have a passion for food, excellent customer service skills, and be able to thrive in a fast-paced environment. Responsibilities include taking orders, serving food and beverages, and ensuring guest satisfaction. We offer a friendly work environment and opportunities for growth.", rating: 4.5, numRatings: 320, priceRange: "$$", openAtNoonWeekday: true },
            { job: "Server", company: "Francesca's Amici", address: "174 N York St, Elmhurst, IL 60126, United States", description: "Join our vibrant team at Francesca's Amici! We're looking for a friendly, efficient, and reliable server to provide exceptional dining experiences. Ideal candidates will have prior serving experience, strong communication skills, and a positive attitude. NOW HIRING Servers, bussers, bartenders... JOIN A WINNING TEAM @ Francesca's Amici in Elmhurst, IL. A successful and neighborhood Italian restaurant/bar that has been around for over 20 years is now hiring servers/bartenders/bussers. Be part of a great opportunity and an amazing staff that delivers first class service. Come show off your personality while giving brilliant service each day, each night, and everytime in-between.", rating: 4.2, numRatings: 580, priceRange: "$$$", openAtNoonWeekday: true },
            { job: "Server", company: "Kingston Mines", address: "2548 N Halsted St, Chicago, IL, United States", description: "Night owl server needed for Chicago's legendary blues club. This is a high-energy, fast-paced environment requiring quick thinking and excellent multi-tasking abilities. Experience in a bar or live music venue is a plus. Must be comfortable working late nights and handling a high volume of customers. Great tips!", rating: 4.6, numRatings: 1200, priceRange: "$$", openAtNoonWeekday: false }, // Assuming a blues club might not be open at noon
            { job: "Server", company: "Longman & Eagle", address: "2657 N Kedzie Ave, Chicago, IL", description: "Award-winning restaurant seeking an experienced server with a strong background in fine dining and craft beverages. Candidates should possess extensive menu knowledge, impeccable service standards, and a genuine passion for hospitality. Sommelier certification is a bonus. We pride ourselves on a unique culinary experience and a strong team.", rating: 4.7, numRatings: 750, priceRange: "$$$$", openAtNoonWeekday: true },
            { job: "Cocktail Server", company: "Vela Bar Cocina", address: "Chicago, IL", description: "Energetic and charismatic cocktail server for a vibrant bar and cocina. Must be 21+ and have experience serving cocktails in a busy setting. Responsibilities include taking drink orders, delivering beverages, and maintaining a clean and inviting bar area. Opportunities for creative input on new drink menus.", rating: 4.3, numRatings: 210, priceRange: "$$$", openAtNoonWeekday: false }, // Assuming a bar might not be open at noon
            { job: "Server", company: "Little Wok", address: "1950 W Division St, Chicago, IL 60622, United States", description: "Part-time server for a popular Asian eatery. We are looking for a reliable individual with flexible hours who can provide friendly and efficient service to our diverse clientele. Experience with Asian cuisine is a plus but not required. Join a close-knit team in a casual, fast-paced environment.", rating: 4.0, numRatings: 180, priceRange: "$", openAtNoonWeekday: true },
            { job: "Server", company: "3rd Coast Cafe & Wine Bar", address: "1260 N Dearborn St, Chicago, IL, United States", description: "Charming cafe and wine bar seeking a server with a passion for hospitality and a good understanding of wine. Responsibilities include serving food and beverages, recommending wine pairings, and creating a welcoming atmosphere for our guests. Ideal for someone who enjoys a relaxed yet sophisticated setting.", rating: 4.4, numRatings: 400, priceRange: "$$$", openAtNoonWeekday: true },
            { job: "Server", company: "Brownstone", address: "3937 N Lincoln Ave, Chicago, IL 60613, United States", description: "Casual American restaurant looking for a reliable and friendly server to join our neighborhood favorite. We value teamwork and a positive attitude. Prior serving experience is preferred, but we are willing to train motivated individuals. Enjoy a steady flow of regulars and a supportive staff.", rating: 4.1, numRatings: 300, priceRange: "$$", openAtNoonWeekday: true },
            { job: "Server", company: "Lark Pizza", address: "3130 North Rockwell Street, Chicago, IL", description: "Pizza restaurant seeking a server to join our fun and dynamic team. If you love pizza and enjoy providing excellent customer service, this is the place for you! Responsibilities include taking orders, serving food, and ensuring a great dining experience for families and friends.", rating: 4.2, numRatings: 250, priceRange: "$", openAtNoonWeekday: true },
            { job: "Server", company: "Chicago Waffles - South Loop", address: "1400 S Michigan Ave, Chicago, IL 60605, USA", description: "Breakfast and lunch server for a busy waffle house in the South Loop. Early mornings and weekend availability are required. Must be able to handle high volume and provide quick, friendly service to our hungry customers. A great spot for early risers!", rating: 4.3, numRatings: 600, priceRange: "$$", openAtNoonWeekday: true },
            { job: "Server", company: "Chicago Waffles - Lincoln Square", address: "4768 North Lincoln Avenue, Chicago, IL", description: "Join our Lincoln Square team! Server position open for a popular brunch spot. We are looking for an energetic individual who enjoys a bustling environment and can provide memorable breakfast and lunch experiences. Become part of a local favorite.", rating: 4.4, numRatings: 550, priceRange: "$$", openAtNoonWeekday: true },
            { job: "Server", company: "Zarella Pizzeria & Taverna", address: "531 N Wells St, Chicago, IL 60654", description: "New pizzeria and taverna hiring servers. This is a great opportunity for growth in a new establishment. We seek individuals with a strong work ethic and a desire to contribute to a positive team atmosphere. Be part of building a new culinary destination.", rating: 4.1, numRatings: 150, priceRange: "$$", openAtNoonWeekday: true },
            { job: "Server", company: "Trino", address: "738 West Randolph Street, Chicago, IL", description: "Upscale restaurant seeking a professional and attentive server for our fine dining establishment. Candidates should have extensive knowledge of food and wine, impeccable service etiquette, and a commitment to guest satisfaction. Experience with high-profile clientele is a plus.", rating: 4.6, numRatings: 380, priceRange: "$$$$", openAtNoonWeekday: true },
            { job: "Server", company: "Moody Tongue Brewing Company", address: "2515 South Wabash Avenue, Chicago, IL", description: "Server for a unique brewing company with a sophisticated tasting room. Craft beer knowledge is a significant plus. Responsibilities include guiding guests through our beer selections and serving food pairings. Ideal for those passionate about brewing and gourmet experiences.", rating: 4.5, numRatings: 290, priceRange: "$$$", openAtNoonWeekday: false }, // Assuming brewery might not be open for full service at noon
            { job: "Server", company: "Mercadito", address: "108 West Kinzie Street, Chicago, IL, United States", description: "Vibrant Mexican restaurant seeking a server with a positive attitude and a passion for Latin cuisine. Must be able to work in a lively environment and provide excellent service to large parties. Experience with a high-volume, energetic crowd is preferred.", rating: 4.3, numRatings: 480, priceRange: "$$$", openAtNoonWeekday: true },
            { job: "Server", company: "Galit", address: "2429 North Lincoln Avenue, Chicago, IL", description: "Michelin-starred Middle Eastern restaurant looking for experienced servers. Candidates should have a refined sense of hospitality, attention to detail, and a deep appreciation for culinary excellence. Prior experience in a similar setting is essential. Join a team dedicated to exceptional dining.", rating: 4.8, numRatings: 620, priceRange: "$$$$", openAtNoonWeekday: true },
            { job: "Banquet Server (On Call)", company: "East Bank Club", address: "Chicago,IL", description: "On-call banquet server for a premier health and fitness club. Responsibilities include setting up and serving at various events, from corporate gatherings to private parties. Flexibility and a professional demeanor are key. Excellent opportunity for supplemental income.", rating: 4.0, numRatings: 90, priceRange: "$$$", openAtNoonWeekday: true },
            { job: "Server", company: "Marriott", address: "Chicago,IL", description: "Hotel server position available at a downtown Marriott location. This role involves serving guests in our hotel restaurant, room service, and potentially banquets. Professionalism and a commitment to guest satisfaction are paramount. Work in a dynamic hospitality environment.", rating: 4.2, numRatings: 700, priceRange: "$$$", openAtNoonWeekday: true },
            { job: "Server", company: "La Grande Boucherie - Chicago", address: "431 North Dearborn Street, Chicago, IL 60654", description: "French brasserie seeking a server with a passion for classic cuisine and an elegant service style. Knowledge of French culinary terms and wine is highly desirable. Join our team and transport guests to the heart of Paris with impeccable service.", rating: 4.5, numRatings: 450, priceRange: "$$$$", openAtNoonWeekday: true },
            { job: "Banquet Server", company: "Julia Valler Event Staffing - Chicago", address: "Chicago, IL", description: "Event staffing company hiring banquet servers for various events across Chicago. We are looking for reliable, professional, and experienced individuals who can adapt to different event settings and client needs. Great for those seeking flexible work.", rating: 4.0, numRatings: 120, priceRange: "$$", openAtNoonWeekday: true },
            { job: "Server", company: "Thattu", address: "2601 W Fletcher St, Chicago, IL 60618, United States", description: "South Indian restaurant seeking a server to provide excellent customer service and introduce guests to our unique flavors. Experience with Indian cuisine is a plus, but a willingness to learn and a friendly attitude are most important. Be part of a growing culinary scene.", rating: 4.6, numRatings: 190, priceRange: "$$", openAtNoonWeekday: true },
            { job: "Server", company: "Grill 21", address: "208 South LaSalle Street, Chicago, IL", description: "Steakhouse and grill looking for a server with strong communication skills and a passion for delivering a premium dining experience. Knowledge of cuts of meat and wine pairings will be beneficial. Work in a sophisticated downtown setting.", rating: 4.4, numRatings: 310, priceRange: "$$$$", openAtNoonWeekday: true },
            { job: "Server", company: "The Drifter", address: "676 North Orleans Street, Chicago, IL 60654, United States", description: "Unique speakeasy bar seeking a server for evening shifts. This role requires a flair for storytelling, excellent cocktail knowledge, and the ability to create an immersive experience for our patrons. Join a team that values creativity and exceptional service.", rating: 4.7, numRatings: 270, priceRange: "$$$", openAtNoonWeekday: false }, // Assuming a speakeasy is not open at noon
            { job: "Lounge Server", company: "The Pearl Club Chicago", address: "495 North Milwaukee Avenue, Chicago, IL", description: "Exclusive lounge seeking a professional and discreet lounge server to cater to our discerning clientele. Experience in high-end establishments and a commitment to privacy and exceptional service are required. This is a role for those who excel in a refined environment.", rating: 4.8, numRatings: 110, priceRange: "$$$$", openAtNoonWeekday: false }, // Assuming a lounge is not open at noon
            { job: "Server", company: "The Green Door Tavern", address: "678 N Orleans St, Chicago, IL, United States", description: "Historic tavern seeking a server to join our friendly team. If you enjoy a lively atmosphere and serving classic American fare, this is the perfect fit. Experience in a high-volume pub environment is a plus. Become part of Chicago's rich history.", rating: 4.3, numRatings: 500, priceRange: "$$", openAtNoonWeekday: true },
            { job: "Server", company: "DeNucci's - Highland Park", address: "1850 2nd Street unit 110, Highland Park, IL", description: "Italian restaurant in Highland Park looking for a dedicated server. We offer a warm, family-friendly atmosphere and seek individuals who can provide attentive and personalized service to our guests. A great opportunity in a charming suburban setting.", rating: 4.1, numRatings: 160, priceRange: "$$", openAtNoonWeekday: true },
            { job: "Barista/FOH", company: "Hewn - Evanston", address: "1733 Central St, Evanston, IL 60201", description: "Artisan bakery and cafe seeking a passionate barista and front-of-house staff. Must have excellent coffee-making skills, a friendly demeanor, and be able to handle transactions and customer inquiries efficiently. Join a team dedicated to quality baked goods and coffee.", rating: 4.5, numRatings: 800, priceRange: "$", openAtNoonWeekday: true },
            { job: "Front Server", company: "Chicago Chop House", address: "60 W Ontario St, Chicago, IL 60654", description: "High-end steakhouse seeking a polished and experienced front server. Responsibilities include assisting the main server, clearing tables, refilling water, and ensuring the dining room runs smoothly. Attention to detail is crucial for this prestigious establishment.", rating: 4.7, numRatings: 900, priceRange: "$$$$", openAtNoonWeekday: true },
            { job: "Server", company: "Monster Ramen", address: "3435 W Fullerton Ave, Chicago, IL 60647, United States", description: "Ramen shop looking for a server to handle orders, deliver delicious ramen, and provide excellent customer service. A love for Japanese cuisine and a fast-paced work ethic are ideal. Join a popular spot known for authentic flavors.", rating: 4.2, numRatings: 220, priceRange: "$", openAtNoonWeekday: true },
            { job: "Server", company: "The Table at Crate", address: "Oak Brook, IL", description: "Restaurant within Crate & Barrel seeking a server for a unique dining experience. This role combines retail and hospitality, requiring a blend of customer service skills and an appreciation for home goods. A distinctive environment for a server.", rating: 4.3, numRatings: 280, priceRange: "$$$", openAtNoonWeekday: true },
            { job: "Server", company: "Valhalla", address: "2020 W Division St, Chicago, IL 60622", description: "Modern American restaurant seeking a server for a dynamic environment. We are looking for individuals who are energetic, adaptable, and committed to providing a memorable dining experience. Be part of a contemporary culinary team.", rating: 4.0, numRatings: 140, priceRange: "$$", openAtNoonWeekday: true },
            { job: "Server", company: "Chicago Athletic Association", address: "12 S Michigan Ave, Chicago, IL 60603", description: "Historic hotel seeking a server for its various dining outlets, including a rooftop bar and a classic tavern. This role requires versatility and the ability to provide high-quality service in different settings. A grand setting for a hospitality professional.", rating: 4.6, numRatings: 1100, priceRange: "$$$$", openAtNoonWeekday: true }
        ];

        let map;
        let geocoder;
        let directionsService;
        let currentInfoWindow = null;
        let userLocation = null;
        let geolocationMessageDiv;
        let distanceCircles = []; // Array to store the distance circles

        /**
         * Displays a message in the geolocation message div.
         * @param {string} message - The message to display.
         * @param {string} type - The type of alert (e.g., 'warning', 'danger').
         */
        function displayGeolocationMessage(message, type) {
            if (geolocationMessageDiv) {
                geolocationMessageDiv.textContent = message;
                geolocationMessageDiv.className = `alert alert-${type}`;
                geolocationMessageDiv.classList.remove('d-none');
            }
        }

        /**
         * Hides the geolocation message div.
         */
        function hideGeolocationMessage() {
            if (geolocationMessageDiv) {
                geolocationMessageDiv.classList.add('d-none');
            }
        }

        /**
         * Draws transparent blue rings around a given center point.
         * Each ring represents a half-mile increment and gets progressively darker.
         * @param {google.maps.LatLngLiteral} center - The center point for the rings (user's location).
         */
        function drawDistanceRings(center) {
            // Clear any existing circles from the map
            distanceCircles.forEach(circle => circle.setMap(null));
            distanceCircles = []; // Reset the array

            const maxDistanceMiles = 4; // Max distance for rings (e.g., up to 4 miles)
            const halfMileInMeters = 804.672; // 0.5 miles in meters

            // Calculate the number of rings based on max distance and increment
            const numRings = Math.floor(maxDistanceMiles / 0.5);

            const baseFillAlpha = 0.05; // Starting transparency for fill (lighter blue)
            const maxFillAlpha = 0.4;   // Ending transparency for fill (darker blue)
            const fillAlphaIncrement = (maxFillAlpha - baseFillAlpha) / numRings;

            const baseStrokeAlpha = 0.2; // Starting transparency for stroke (lighter grey)
            const maxStrokeAlpha = 1.0;  // Ending transparency for stroke (black)
            const strokeAlphaIncrement = (maxStrokeAlpha - baseStrokeAlpha) / numRings;

            for (let i = 1; i <= numRings; i++) {
                const radius = i * halfMileInMeters;
                const currentFillAlpha = baseFillAlpha + (i - 1) * fillAlphaIncrement;
                const currentStrokeAlpha = baseStrokeAlpha + (i - 1) * strokeAlphaIncrement;

                const fillColor = `rgba(0, 0, 255, ${currentFillAlpha})`; // Blue color with increasing opacity
                const strokeColor = `rgba(0, 0, 0, ${currentStrokeAlpha})`; // Black color with increasing opacity

                const circle = new google.maps.Circle({
                    strokeColor: strokeColor, // Dynamic stroke color (grey to black)
                    strokeOpacity: 0.8,
                    strokeWeight: 1,
                    fillColor: fillColor,
                    fillOpacity: currentFillAlpha, // Dynamic fill opacity
                    map: map,
                    center: center,
                    radius: radius
                });
                distanceCircles.push(circle); // Store the circle object
            }
        }

        /**
         * Initializes the Google Map and geocoder.
         * This function is called by the Google Maps API script once it's loaded.
         */
        function initMap() {
            geolocationMessageDiv = document.getElementById('geolocation-message');

            // Initialize the map centered around Chicago
            map = new google.maps.Map(document.getElementById("map"), {
                center: { lat: 41.8781, lng: -87.6298 }, // Default to Chicago coordinates
                zoom: 10,
                gestureHandling: 'greedy' // Enable one-finger pan/zoom on touch devices
            });

            // Initialize the Geocoder service
            geocoder = new google.maps.Geocoder();
            directionsService = new google.maps.DirectionsService();

            // Try to get user's current location
            if (navigator.geolocation) {
                displayGeolocationMessage("Attempting to get your location...", "warning");
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        hideGeolocationMessage(); // Hide message on success
                        userLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude,
                        };
                        // Add marker for user's location
                        new google.maps.Marker({
                            map: map,
                            position: userLocation,
                            title: "Your Location",
                            icon: {
                                path: google.maps.SymbolPath.CIRCLE,
                                scale: 8,
                                fillColor: '#4285F4', // Google Blue
                                fillOpacity: 0.8,
                                strokeWeight: 2,
                                strokeColor: '#FFFFFF'
                            },
                            label: {
                                text: "You",
                                color: 'white',
                                fontSize: '10px',
                                fontWeight: 'bold'
                            }
                        });
                        map.setCenter(userLocation); // Center map on user's location
                        drawDistanceRings(userLocation); // Draw rings around user's location
                        processJobListings(); // Process job listings after getting user location
                    },
                    (error) => {
                        // Handle geolocation errors
                        let errorMessage = "Error getting your location. ";
                        switch (error.code) {
                            case error.PERMISSION_DENIED:
                                errorMessage += "Permission denied. Please enable location services for this site in your browser settings. Note: Geolocation often requires HTTPS.";
                                break;
                            case error.POSITION_UNAVAILABLE:
                                errorMessage += "Your location information is unavailable.";
                                break;
                            case error.TIMEOUT:
                                errorMessage += "The request to get user location timed out.";
                                break;
                            default:
                                errorMessage += "An unknown error occurred.";
                                break;
                        }
                        displayGeolocationMessage(errorMessage, "danger");
                        console.error("Geolocation error:", error);
                        // Still process job listings even if user location fails, but walking times will be N/A
                        processJobListings();
                    },
                    {
                        enableHighAccuracy: true, // Request high accuracy
                        timeout: 10000, // 10 seconds timeout
                        maximumAge: 0 // Don't use cached position
                    }
                );
            } else {
                displayGeolocationMessage("Geolocation is not supported by your browser. Your location cannot be displayed.", "danger");
                console.warn("Geolocation is not supported by this browser.");
                processJobListings(); // Proceed without user location
            }

            // Close info window when clicking on the map itself
            map.addListener('click', () => {
                if (currentInfoWindow) {
                    currentInfoWindow.close();
                    currentInfoWindow = null; // Reset to null after closing
                }
            });
        }

        /**
         * Processes each job listing, geocodes its address, and adds a marker to the map.
         */
        async function processJobListings() {
            for (const listing of jobListings) {
                // Attempt to geocode the address
                try {
                    const response = await geocoder.geocode({ address: listing.address });

                    if (response.results && response.results.length > 0) {
                        const location = response.results[0].geometry.location;
                        // Pass the entire listing object and userLocation to the addMarker function
                        addMarker(location, listing, userLocation);
                    } else {
                        console.warn(`Could not find location for: ${listing.address}`);
                    }
                } catch (error) {
                    console.error(`Geocoding error for ${listing.address}:`, error);
                }
            }
        }

        /**
         * Adds a marker to the map at the given location with an info window and a custom label.
         * @param {google.maps.LatLng} location - The latitude and longitude for the marker.
         * @param {object} listing - The full job listing object containing all details.
         * @param {google.maps.LatLngLiteral} userLoc - User's current location for directions.
         */
        async function addMarker(location, listing, userLoc) {
            let labelText = '';
            if (listing.priceRange && listing.rating) {
                labelText = `${listing.priceRange}, ${listing.rating}`;
            } else if (listing.priceRange) {
                labelText = listing.priceRange;
            } else if (listing.rating) {
                labelText = String(listing.rating); // Ensure it's a string
            }

            // Determine marker color based on openAtNoonWeekday property
            const markerColor = listing.openAtNoonWeekday ? '#008000' : '#EA4335'; // Green or Red

            const marker = new google.maps.Marker({
                map: map,
                position: location,
                title: `${listing.job} at ${listing.company}`,
                icon: {
                    path: google.maps.SymbolPath.FORWARD_CLOSED_ARROW, // Using a pin-like symbol
                    fillColor: markerColor, // Set color based on condition
                    fillOpacity: 1,
                    strokeColor: '#000000',
                    strokeWeight: 1,
                    scale: 5, // Adjust size of the pin
                    rotation: 180, // Rotate to point downwards
                    anchor: new google.maps.Point(0, 8), // Adjust anchor to base of the pin
                },
                label: {
                    text: labelText,
                    color: 'black', // Label color is black
                    fontSize: '12px',
                    fontWeight: 'bold'
                }
            });

            let walkingTime = 'Calculating...';
            // Only calculate walking time if user location is available
            if (userLoc) {
                try {
                    const directionsRequest = {
                        origin: userLoc,
                        destination: location,
                        travelMode: google.maps.TravelMode.WALKING
                    };
                    const directionsResponse = await directionsService.route(directionsRequest);

                    if (directionsResponse.routes && directionsResponse.routes.length > 0) {
                        walkingTime = directionsResponse.routes[0].legs[0].duration.text;
                    } else {
                        walkingTime = 'N/A (No walking route found)';
                    }
                } catch (e) {
                    console.error("Error calculating directions:", e);
                    walkingTime = 'N/A (Error calculating route)';
                }
            } else {
                walkingTime = 'N/A (Your location not available)';
            }

            let descriptionContent = '';
            const splitKeyword = 'NOW HIRING';

            if (listing.description && listing.description.includes(splitKeyword)) {
                const parts = listing.description.split(splitKeyword);
                const mainDescription = parts[0].trim();
                const expandedDescription = splitKeyword + parts.slice(1).join(splitKeyword).trim();

                descriptionContent = `
                    <p><strong><em>Description:</em></strong> ${mainDescription}</p>
                    <p><br><strong><em>Expanded Description:</em></strong> ${expandedDescription}</p>
                `;
            } else {
                descriptionContent = `<p><strong><em>Description:</em></strong> ${listing.description || 'No description available.'}</p>`;
            }

            const infoWindowContent = `
                <div class="info-window-content">
                    <h3>${listing.job}</h3>
                    <p><strong><em>Company:</em></strong> ${listing.company}</p>
                    <p><strong><em>Address:</em></strong> ${listing.address}</p>
                    <p><strong><em>Rating:</em></strong> ${listing.rating || 'N/A'} (${listing.numRatings || 0} reviews)</p>
                    <p><strong><em>Price Range:</em></strong> ${listing.priceRange || 'N/A'}</p>
                    <p><strong><em>Walking Time from Your Location:</em></strong> ${walkingTime}</p>
                    ${descriptionContent}
                </div>
            `;

            const infoWindow = new google.maps.InfoWindow({
                content: infoWindowContent,
            });

            marker.addListener("click", () => {
                // Close any currently open info window
                if (currentInfoWindow) {
                    currentInfoWindow.close();
                }
                infoWindow.open(map, marker);
                currentInfoWindow = infoWindow; // Set the newly opened info window as current
            });
        }
    </script>
    <!-- Google Maps JavaScript API script -->
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCnmB1YdRWQnp4pdFRymNhkOozpvZMsY_I&libraries=places,geometry,routes&callback=initMap"></script>
</body>
</html>
